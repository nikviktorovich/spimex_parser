# Spimex parser
## Описание
Данное приложение загружает данные о результатах торгов с сайта Spimex и сохраняет их в базу данных

## Установка и запуск
Для установки данного приложения требуется Python 3.6+. Для установки приложения необходимо:

Загрузить данные репозитория через `git`:
```bash
git clone -b dev-async https://github.com/nikviktorovich/spimex_parser.git
cd spimex_parser
```

(Желательно) Создать виртуальное окружение
```bash
python -m venv venv
source venv/bin/activate
```

Установить зависимости:
```bash
python -m pip install -r requirements.txt
```

На этом этап установки заканчивается. Далее, необходимо запустить базу данных PostgreSQL. Самым удобным способом будет запуск через Docker:
```bash
docker run --name pg --rm -p 5432:5432 -e POSTGRES_DB=your_name -e POSTGRES_PASSWORD=your_password -d postgres
```

Инструкция для запуска приложения:

Синхронная версия консольного приложения:
```bash
python src/spimex_parser/apps/console/main.py
```

Асинхронная версия консольного приложения:
```bash
python src/spimex_parser/apps/console_async/main.py
```

## Структура файлов
В корневом каталоге лежат файлы, имеющие отношение к окружению приложения и репозитория.

В папке `src/` находится исходный код и данные пакета.

В папке `tests/` находятся тесты приложения.

## Структура модулей приложения
Модуль `apps` отвечает за приложения, использующие модули, содержащие логику. В данном случае, там находятся 2 приложения с консольным пользовательским интерфейсом: `console` и `console_async`.

Модуль `config` содержит конфигурационные данные приложения (среди которых, например, данные для подключения к базе данных)

Модуль `domain` содержит информацию о доменной области приложения

Модуль `modules` содержит основную логику приложения и разделен на следующие дочерние модули:
- Модуль `datetime_util` содержит вспомогательные модули для работы с датой и временем
- Модуль `data_storage` содержит логику хранения данных о результатах торгов
    - Дочерний модуль `asyncio` содержит асинхронную версию модуля
- Модуль `parser` содержит логику извлечения данных с сайта Spimex
    - Дочерний модуль `asyncio` содержит асинхронную версию модуля

## Архитектура модулей
Модули `*.unit_of_work` содержат реализации паттерна Unit Of Work для упрощения доступа к данным модуля посредством менеджера контекста

Модули `*.repositories` содержат реализации паттерна Repository - интерфейса для доступа к данным модуля

## Тесты
Тесты требуют запущенный сервис управления базой данных, подключение к которой осуществляется с помощью данных из файла `.env` или переменных окружения. Тесты можно запустить следующим образом:
```bash
python -m pytest tests/
```
